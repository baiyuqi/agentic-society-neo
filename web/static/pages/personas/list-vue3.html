<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>角色列表 - Agentic Society</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.21/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
        }
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border-radius: 0.5rem;
            margin-bottom: 20px;
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 0.5rem 0.5rem 0 0 !important;
        }
        .table {
            font-size: 0.9rem;
        }
        .table th {
            border-top: none;
            font-weight: 600;
            color: #495057;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container-fluid">
            <!-- Database Selection -->
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-database me-2"></i>选择数据源</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">选择数据库:</label>
                        <select class="form-select" v-model="selectedDatabase" @change="loadPersonas">
                            <option value="">请选择数据库...</option>
                            <option v-for="db in databases" :value="db.path">{{ db.name }}</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div v-if="selectedDatabase">
                <!-- Header -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-list-ul me-2"></i>角色列表</h5>
                    </div>
                    <div class="card-body">
                        <div v-if="loading" class="text-center">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">加载中...</span>
                            </div>
                        </div>
                        <div v-else-if="error" class="alert alert-danger">
                            {{ error }}
                        </div>
                        <div v-else>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="text-muted">共 {{ personas.length }} 个角色</span>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary btn-sm" @click="loadPersonas">
                                    <i class="bi bi-arrow-clockwise me-1"></i>刷新
                                </button>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>年龄</th>
                                        <th>性别</th>
                                        <th>职业</th>
                                        <th>开放性</th>
                                        <th>尽责性</th>
                                        <th>外向性</th>
                                        <th>宜人性</th>
                                        <th>神经质</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="persona in personas" :key="persona.id">
                                        <td>{{ persona.id }}</td>
                                        <td>{{ persona.age }}</td>
                                        <td>{{ persona.gender }}</td>
                                        <td>{{ persona.occupation }}</td>
                                        <td>{{ persona.openness ? persona.openness.toFixed(2) : 'N/A' }}</td>
                                        <td>{{ persona.conscientiousness ? persona.conscientiousness.toFixed(2) : 'N/A' }}</td>
                                        <td>{{ persona.extraversion ? persona.extraversion.toFixed(2) : 'N/A' }}</td>
                                        <td>{{ persona.agreeableness ? persona.agreeableness.toFixed(2) : 'N/A' }}</td>
                                        <td>{{ persona.neuroticism ? persona.neuroticism.toFixed(2) : 'N/A' }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div v-if="personas.length === 0" class="text-center text-muted mt-5">
                            <i class="bi bi-people display-4"></i>
                            <p class="mt-3">没有找到角色数据</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;

        const app = createApp({
            setup() {
                const databases = ref([]);
                const selectedDatabase = ref('');
                const personas = ref([]);
                const loading = ref(false);
                const error = ref(null);

                const loadDatabases = async () => {
                    try {
                        const response = await fetch('/api/databases');
                        databases.value = await response.json();
                    } catch (err) {
                        error.value = '加载数据库列表失败: ' + err.message;
                    }
                };

                const loadPersonas = async () => {
                    if (!selectedDatabase.value) return;

                    try {
                        loading.value = true;
                        error.value = null;

                        const response = await fetch(`/api/personas?db=${encodeURIComponent(selectedDatabase.value)}`);
                        if (!response.ok) {
                            throw new Error('获取角色列表失败');
                        }

                        personas.value = await response.json();
                    } catch (err) {
                        error.value = err.message;
                    } finally {
                        loading.value = false;
                    }
                };

                onMounted(async () => {
                    await loadDatabases();
                });

                return {
                    databases,
                    selectedDatabase,
                    personas,
                    loading,
                    error,
                    loadDatabases,
                    loadPersonas
                };
            }
        });

        app.mount('#app');
    </script>
</body>
</html>