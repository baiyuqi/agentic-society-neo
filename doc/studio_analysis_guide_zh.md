# Agentic Society Studio 数据分析工具使用指南

## 1. 引言

Agentic Society Studio 内置了一系列强大的数据分析工具，其核心目标是帮助研究人员和开发者**评估、理解和比较由大型语言模型（LLM）生成的虚拟人格画像（Personality Profiles）的特性**。

这些工具能回答以下关键问题：
-   一个LLM在被赋予特定人格设定后，其行为是否具有**内部一致性**？
-   两个或多个不同的人格设定，是否能生成在统计上和视觉上**可被区分**的画像？
-   多个画像之间的“可区分性”或“相似度”有多大？

本指南将详细介绍“数据分析”模块下的每一个功能。

---

## 2. 单文件分析

这类分析针对**单个**数据库（`.db`）文件，旨在评估单个画像的内部特征。

### 马氏距离分析 (Mahalanobis Distance)

-   **功能与用途**：
    此工具用于评估**单个画像的内部一致性与分布形态**。它计算该画像中每一个数据点（即每一次性格测试的结果）到整个数据集中心点的马氏距离。马氏距离是一种考虑了数据各维度之间相关性的高级距离度量。
    -   如果一个画像是**高度一致和集中的**（即LLM稳定地表现出同一种人格），那么大部分数据点的马氏距离都会很小，分布会很紧凑。
    -   如果画像**松散或包含异常点**，则距离分布会更分散，可能会出现较大的值。

-   **如何使用**：
    1.  在左侧菜单树中，点击“数据分析” -> “马氏距离分析 (单文件)”。
    2.  在右侧面板中，点击“选择数据库文件 (Select DB File)...”按钮，选择一个您想要分析的 `.db` 文件。
    3.  面板会自动生成并显示一个直方图。

-   **如何解读结果**：
    -   **横轴 (X-axis)**：马氏距离的值。
    -   **纵轴 (Y-axis)**：拥有该距离值的数据点数量。
    -   **理想形态**：一个理想的、内部一致的画像通常会呈现一个**右偏（positively skewed）**的分布。即，大部分数据点聚集在左侧（距离小），只有少数点离中心较远。
    -   **异常形态**：如果直方图呈现双峰、均匀分布或有非常长的尾巴，则可能意味着该画像内部存在不一致、包含多个子群体或有极端异常值。

-   **核心算法介绍**：
    -   **马氏距离 (Mahalanobis Distance)**：它为何优于我们熟悉的欧氏距离（两点直线距离）？想象一下，如果“外向性”得分普遍在40-60之间，而“神经质”得分在10-90之间，一个在“外向性”上偏差5分的点，比一个在“神经质”上偏差5分的点要严重得多。此外，如果“开放性”和“宜人性”总是同增同减（正相关），一个点在“开放性”上高但在“宜人性”上低，就显得很“奇怪”。
    -   马氏距离正是解决了这两个问题：1) 它用**标准差**对每个维度进行归一化，消除了量纲的影响；2) 它使用**协方差矩阵**来考虑维度间的相关性。因此，它度量的是一个点到数据中心的“统计学距离”，是多维数据**异常检测**的黄金标准。

---

## 3. 多文件/目录分析

这类分析针对一个包含**多个**数据库文件的目录，旨在比较不同画像之间的异同。

### 聚类分析 (Clustering Analysis)

-   **功能与用途**：
    此工具使用 **K-Means 聚类算法**来**量化评估多个画像的可区分性**。它将来自不同画像的所有数据点混合在一起，然后尝试将它们重新分成 K 个簇（K 通常等于画像的数量），完全不考虑它们的原始来源。最后，它通过**调整兰德指数 (Adjusted Rand Index, ARI)** 来比较聚类结果与真实来源的一致性。

-   **如何使用**：
    1.  点击“数据分析” -> “聚类分析 (多文件)”。
    2.  点击“浏览目录 (Browse Directory)...”并选择一个包含多个 `.db` 文件的目录。
    3.  点击“运行聚类 (Run Clustering)”。

-   **如何解读结果**：
    -   **调整兰德指数 (ARI)**：
        -   **ARI = 1.0**: 完美匹配。聚类算法找到的簇与原始的画像文件完全对应，意味着这些画像**极易区分**。
        -   **ARI ≈ 0.0**: 随机分配。聚类结果与随机猜测无异，意味着这些画像**几乎无法区分**。
        -   **ARI < 0.0**: 比随机还差。
    -   **PCA 散点图**：
        -   图上的每一个点代表一次性格测试结果。
        -   **点的颜色 (Predicted Cluster)**：代表K-Means算法分配的簇。
        -   **点的形状 (True Profile)**：代表它真实的来源文件。
        -   **理想情况**：如果画像可区分性好，那么**相同形状的点应该具有相同的颜色**，并且在图上形成泾渭分明的色块。

-   **核心算法介绍**：
    -   **K-Means 聚类**：一种简单高效的迭代式聚类算法。1) 随机选择K个点作为初始簇中心；2) 将每个数据点分配给离它最近的簇中心；3) 将每个簇的中心更新为该簇所有数据点的平均值；4) 重复步骤2和3，直到簇中心不再变化为止。
    -   **调整兰德指数 (ARI)**：它通过计算数据点对的“配对协议”来衡量聚类效果。一个点对，在真实标签中和预测标签中，可能都属于同一个簇（a），或都属于不同簇（b），或者在一个分类中同属一簇在另一个分类中不同属一簇（c,d）。ARI基于a,b,c,d的数量计算出一个分数，并对其进行了“机会校正”，即减去了随机期望得到的分数。这使得它在不同大小和数量的簇之间具有可比性，非常可靠。
    -   **主成分分析 (PCA)**：一种线性的降维方法。它通过数学变换找到数据中方差最大的方向（第一主成分），然后是与前者正交的、方差次大的方向（第二主成分），以此类推。通过保留前两个或前三个主成分，我们可以在牺牲最少信息量的前提下，将高维数据（如5维）投影到2D或3D平面上进行可视化。

### t-SNE 可视化 (t-SNE Visualization)

-   **功能与用途**：
    t-SNE 是一种强大的**非线性降维技术**，非常擅长将高维数据（如5维的性格向量）投影到2D平面上，同时尽可能保持其局部的相似性结构。它纯粹用于**可视化探索**，帮助您直观地观察不同画像的数据点在空间中是如何分布和分离的。

-   **如何使用**：
    1.  点击“数据分析” -> “t-SNE 可视化 (多文件)”。
    2.  选择一个包含多个 `.db` 文件的目录。
    3.  点击“运行 t-SNE (Run t-SNE)”。

-   **如何解读结果**：
    -   图上的每一个点代表一次性格测试结果，颜色代表其来源文件。
    -   **理想情况**：如果多个画像是高度可区分的，那么在t-SNE图上，**相同颜色的点会自然地聚集在一起，形成清晰、分离的“岛屿”或“大陆”**。
    -   **混合情况**：如果不同颜色的点大量重叠、混合在一起，则说明这些画像在特征空间中非常相似，难以区分。

-   **核心算法介绍**：
    -   **t-分布随机邻域嵌入 (t-SNE)**：它的工作方式很精妙。首先，它在原始高维空间中，将数据点之间的欧氏距离转化为一个条件概率，表示点A会选择点B作为其邻居的可能性（距离越近，概率越高）。然后，它在低维空间（如2D）中也定义一个类似的概率分布（使用更“重尾”的t分布，以缓解“拥挤问题”）。最后，它通过优化算法，不断调整低维空间中各点的位置，使得两个空间的概率分布尽可能地相似。这个过程保留了数据的局部“邻居”关系，因此非常擅长可视化高维数据的内在流形结构。**注意**：t-SNE图上簇与簇之间的距离大小不一定具有真实的数学意义，应主要关注点簇的形成和分离情况。

### 画像对比分析 (多模式)

这是一个功能强大的复合型分析面板，包含两个标签页，提供从不同角度的对比分析。

#### 标签页一：目录分布对比 (Directory Distribution)

-   **功能与用途**：
    此功能用于对一个目录下的**所有**画像进行**并排的、详细的视觉比较**。它能让您直观地检查每个画像在各个维度上的得分分布，以及它们在整体特征空间中的相对位置。

-   **如何使用**：
    1.  点击“数据分析” -> “画像对比分析 (多模式)”。
    2.  确保您在“目录分布对比”标签页下。
    3.  点击顶部的“选择目录...”按钮。
    4.  点击“运行分布分析”。

-   **如何解读结果**：
    -   **小提琴图 (Violin Plots)**：上方的一排图表。每个小提琴图展示了一个画像（由X轴上的文件名标识）在某个特定性格维度（如“开放性”）上的得分分布。您可以快速比较：
        -   **形状**：分布是宽还是窄？是单峰还是多峰？
        -   **中位数**：白点的位置代表了得分的中位数。
        -   **范围**：琴身的长度代表了得分的整体范围。
    -   **PCA “云图”**：下方的大图。它将目录中**所有**画像的数据点都画在同一张图上，每个画像用一种颜色表示。这可以看作是“聚类分析”和“t-SNE”图的另一种形式，用于直观评估所有画像的总体分离情况。

-   **核心算法介绍**：
    -   **小提琴图 (Violin Plot)**：它是**箱形图 (Box Plot)** 与 **核密度估计 (Kernel Density Estimation, KDE)** 的结合体。箱形图展示了数据的分位数（中位数、四分位数等），而KDE则展示了数据在任意位置的概率密度，即分布的“平滑直方图”。小提琴图将两者结合，既能看到关键的统计摘要，又能看到数据的完整分布形状，比单独使用任何一种都更具信息量。
    -   **PCA**：原理同“聚类分析”部分所述。

#### 标签页二：目录热力图分析 (Directory Heatmap)

-   **功能与用途**：
    此功能提供了一种**快速、量化地概览一个目录中所有画像对之间可区分性**的方法。它计算每一对画像之间的**马氏距离**，并用一个**热力图 (Heatmap)** 来展示结果。

-   **如何使用**：
    1.  切换到“目录热力图分析”标签页。
    2.  如果尚未选择目录，请点击顶部的“选择目录...”按钮。
    3.  点击“生成热力图”。

-   **如何解读结果**：
    -   这是一个对称的矩阵，行和列都是目录中的文件名。
    -   矩阵中每个单元格的**数值和颜色**代表了对应行列两个画像之间的马氏距离。
    -   **距离越大（颜色越亮/越“热”）**，代表这两个画像在多维特征空间中的中心点相距越远，它们的**可区分性越强**。
    -   **距离越小（颜色越暗/越“冷”）**，代表这两个画像越**相似，越难以区分**。
    -   通过观察热力图，您可以迅速识别出哪些画像对最相似，哪些最独特。

-   **核心算法介绍**：
    -   **群体间马氏距离**：当计算两个数据**群体**（而不是单个点）之间的马氏距离时，我们实际上是在计算两个群体**均值向量**之间的距离。这里的关键是，我们不能简单地使用其中一个群体的协方差矩阵，也不能将它们简单相加。正确的做法是计算一个**池化协方差矩阵 (Pooled Covariance Matrix)**。它是两个群体协方差矩阵的加权平均值（权重由各自的样本量决定）。这提供了一个更稳健、更准确的对两个群体共同的方差结构的估计，使得计算出的距离更具统计意义。