<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试马氏距离收敛性分析</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>测试马氏距离收敛性分析图表</h1>
    <div style="width: 800px; height: 400px;">
        <canvas id="testChart"></canvas>
    </div>

    <script>
        // 模拟API返回的数据结构
        const mockData = {
            poor300: {
                distances_clean: [1.5, 1.8, 2.1, 2.4, 1.7, 2.0, 2.3, 1.9, 2.2, 1.6],
                label: 'Poor Quality',
                color: 'red'
            },
            samples300: {
                distances_clean: [1.6, 1.9, 2.2, 2.5, 1.8, 2.1, 2.4, 2.0, 2.3, 1.7],
                label: 'Standard Sample',
                color: 'blue'
            },
            narrative300: {
                distances_clean: [1.4, 1.7, 2.0, 2.3, 1.6, 1.9, 2.2, 1.8, 2.1, 1.5],
                label: 'Narrative',
                color: 'green'
            }
        };

        // 创建KDE数据
        function createKDE(data, bandwidth = 0.5) {
            const min = Math.min(...data) - 0.5;
            const max = Math.max(...data) + 0.5;
            const x = Array.from({length: 100}, (_, i) => min + (max - min) * i / 99);

            const y = x.map(xVal => {
                return data.reduce((sum, d) => {
                    const diff = (d - xVal) / bandwidth;
                    return sum + Math.exp(-0.5 * diff * diff);
                }, 0) / (data.length * bandwidth * Math.sqrt(2 * Math.PI));
            });

            return x.map((xVal, i) => ({x: xVal, y: y[i]}));
        }

        // 准备数据集
        const datasets = [];
        for (const [sourceName, result] of Object.entries(mockData)) {
            const kdeData = createKDE(result.distances_clean);
            datasets.push({
                label: result.label,
                data: kdeData,
                borderColor: result.color,
                backgroundColor: result.color,
                borderWidth: 2,
                fill: false,
                tension: 0.4
            });
        }

        // 创建图表
        const ctx = document.getElementById('testChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: { datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear',
                        title: { display: true, text: '马氏距离' },
                        min: 1,
                        max: 3
                    },
                    y: {
                        title: { display: true, text: '概率密度' },
                        beginAtZero: true
                    }
                }
            }
        });

        console.log('测试图表创建成功');
    </script>
</body>
</html>